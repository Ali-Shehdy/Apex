@page
@model Apex.Events.Pages.EventsList.CreateModel

<h2>Create Event</h2>

@if (TempData["DebugCreate"] != null)
{
    <div class="alert alert-warning">@TempData["DebugCreate"]</div>
}

<!-- ================= FORM 1: LOAD VENUES ================= -->
<form method="post" asp-page-handler="LoadVenues" class="mb-4">

    <div asp-validation-summary="All" class="text-danger"></div>

    <div class="mb-3">
        <label asp-for="Event.EventName"></label>
        <input asp-for="Event.EventName" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Event Type</label>
        <select asp-for="SelectedEventTypeId"
                asp-items="Model.EventTypeSelectList"
                class="form-select">
            <option value="">-- Select Event Type --</option>
        </select>
    </div>

    <div class="mb-3">
        <label>Event Date</label>
        <input asp-for="SelectedDate" type="date" class="form-control" />
    </div>

    <button type="submit" class="btn btn-secondary">
        Load Available Venues
    </button>
</form>

@if (Model.VenuesLoaded)
{
    <hr />

    <!-- ================= FORM 2: CREATE EVENT ================= -->
        

    <form method="post" asp-page-handler="">
        <div asp-validation-summary="All" class="text-danger"></div>

        <input type="hidden" asp-for="Event.EventName" />
        <input type="hidden" asp-for="SelectedEventTypeId" />
        <input type="hidden" asp-for="SelectedDate" />
        <input type="hidden" asp-for="VenuesLoaded" />

        <div class="mb-3">
            <label>Available Venues</label>
            <select asp-for="SelectedVenueCode" class="form-select">
                <option value="">-- Select Venue --</option>
                @foreach (var venue in Model.AvailableVenues)
                {
                    <option value="@venue.Code">
                        @venue.Name (Capacity: @venue.Capacity)
                    </option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary">
            Create Event
        </button>

        <div class="alert alert-info mt-3">
            Debug:
            EventType=<b>@Model.SelectedEventTypeId</b>,
            Date=<b>@Model.SelectedDate:yyyy-MM-dd</b>,
            Venues=<b>@Model.AvailableVenues.Count</b>,
            SelectedVenue=<b>@Model.SelectedVenueCode</b>
        </div>

    </form>
}
